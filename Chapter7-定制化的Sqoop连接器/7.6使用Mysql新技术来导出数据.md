<h2>7.6使用Mysql新技术来导出数据</h2>

<h3>问题</h3>
已经修改了Hadoop中的数据集, 并且希望将这些更改传回MySQL数据库。数据转换既更新现有行,又创建新的的。在更新模式allowinsert参数中使用Sqoop的 
upsert功能时,注意到Sqoop不使用在中指定的任何列 -updatekey, 以确定是更新现有行还是插入新行。

<h3>解决方案</h3>
需要在所有要使用的列上创建--update-key参数。例如,若要在"cities"表的"city"列中创建唯一键, 可以执行以下 MySQL 查询。

```
ALTER TABLE cities ADD UNIQUE KEY (city);
```

<h3>讨论</h3>

MySQL数据库不像Oracle那样支持合并SQL运算符。相反,MySQL提供了Sqoop在导出时使用的重复密钥更新子句。在upsert模式下,合并操作允许指定
一个条件以确定是否应执行更新或插入操作,MySQL的句将始终尝试插入。只有当插入失败,因为这样的操作会违反唯一的键约束,它才会更新现有的行,
由于 MySQL不允许若要指定条件, 始终使用表的唯一键。因为Sqoop使用的是重复密钥更新子句, 所以更新键参数中指定的列是不用于确定应执行的操作。
这非常令人费解,因为总是必须指定此参数才能启用更新模式, 但在upsert模式下不使用列。